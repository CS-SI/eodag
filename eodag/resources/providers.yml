# -*- coding: utf-8 -*-
# Copyright 2018, CS Systemes d'Information, http://www.c-s.fr
#
# This file is part of EODAG project
#     https://www.github.com/CS-SI/EODAG
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
!provider
  name: usgs
  priority: 0
  api: !plugin
    type: UsgsApi
    google_base_url: 'http://storage.googleapis.com/earthengine-public/landsat/'
    metadata_mapping:
      id: '$.entityId'
      geometry: '$.geometry'
      productType: '$.productType'
      title: '$.displayId'
      abstract: '$.summary'
      startTimeFromAscendingNode: '$.startTime'
      completionTimeFromAscendingNode: '$.endTime'
      quicklook: '$.browserUrl'
    extract: True
  products:
    L8_OLI_TIRS_C1L1:
      dataset: LANDSAT_8_C1
      catalog_node: EE  # Possible values: CWIC, EE, HDDS, LPCS

---
!provider
  name: aws_s3_sentinel2_l1c
  priority: 0
  search: !plugin
    type: AwsSearch
    api_endpoint: 'http://finder.eocloud.eu/resto/api/'
    product_location_scheme: 's3'
    metadata_mapping:
      id: '$.id'
      geometry:
        - box
        - '$.geometry'
      productType:
        - productType
        - '$.properties.productType'
      platform: '$.properties.collection'
      platformSerialIdentifier: '$.properties.platform'
      instrument: '$.properties.instrument'
      processingLevel: '$.properties.processingLevel'
      title: '$.properties.title'
      keyword: '$.properties.keywords'
      abstract: '$.properties.description'
      organisationName: '$.properties.organisationName'
      orbitNumber: '$.properties.orbitNumber'
      orbitDirection: '$.properties.orbitDirection'
      cloudCover:
        - cloudCover
        - '$.properties.cloudCover'
      snowCover: '$.properties.snowCover'
      startTimeFromAscendingNode:
        - startDate
        - '$.properties.startDate'
      completionTimeFromAscendingNode:
        - completionDate
        - '$.properties.completionDate'
      parentIdentifier: '$.properties.parentIdentifier'
      resolution: '$.properties.resolution'
      sensorMode: '$.properties.sensorMode'
      quicklook: '$.properties.quicklook'
  products:
    S2_MSI_L1C:
      product_type: L1C
      collection: Sentinel2
  download: !plugin
    type: AwsDownload
    associated_bucket: 'sentinel-s2-l1c'
  auth: !plugin
    type: OAuth

---
!provider
  name: theia_landsat
  priority: 0
  products:
    LS_REFLECTANCE:
      collection: Landsat
      product_type: REFLECTANCE
    LS_REFLECTANCETOA:
      collection: Landsat
      product_type: REFLECTANCETOA
    PLD_REFLECTANCE:
      collection: Pleiades
      product_type: REFLECTANCE
    PLD_REFLECTANCETOA:
      collection: Pleiades
      product_type: REFLECTANCETOA
    PLD_BUNDLE:
      collection: Pleiades
      product_type: Bundle (Pan, XS)
  search: !plugin
    type: RestoSearch
    api_endpoint: 'https://theia-landsat.cnes.fr/resto/api/'
    product_location_scheme: https
    metadata_mapping:
      id: '$.id'
      geometry:
        - box
        - '$.geometry'
      productType:
        - productType
        - '$.properties.productType'
      platform: '$.properties.collection'
      platformSerialIdentifier: '$.properties.platform'
      instrument: '$.properties.instrument'
      processingLevel: '$.properties.processingLevel'
      title: '$.properties.title'
      keyword: '$.properties.keywords'
      organisationName: '$.properties.organisationName'
      orbitNumber: '$.properties.orbitNumber'
      orbitDirection: '$.properties.orbitDirection'
      cloudCover:
        - cloudCover
        - '$.properties.cloudCover'
      snowCover: '$.properties.snowCover'
      startTimeFromAscendingNode:
        - startDate
        - '$.properties.startDate'
      completionTimeFromAscendingNode:
        - completionDate
        - '$.properties.completionDate'
      parentIdentifier: '$.properties.parentIdentifier'
      resolution: '$.properties.resolution'
      sensorMode: '$.properties.sensorMode'
      productVersion: '$.properties.version'
      quicklook: '$.properties.quicklook'
  download: !plugin
    type: HTTPDownload
    base_uri: 'https://theia-landsat.cnes.fr/resto'
    extract: true
  auth: !plugin
    type: OIDCAuthorizationCodeFlowAuth
    login_form_xpath: '//form[@id="loginForm"]'
    authentication_uri_source: 'config'
    additional_login_form_data:
      sessionDataKey:  'xpath(//input[@name="sessionDataKey"]/@value)'
    user_consent_needed: True
    user_consent_form_xpath: '//form[@id="profile"]'
    user_consent_form_data:
      consent: 'approve'
      sessionDataKeyConsent: 'xpath(//input[@name="sessionDataKeyConsent"]/@value)'
    authorization_uri: 'https://sso.theia-land.fr/oauth2/authorize'
    redirect_uri: 'https://theia-landsat.cnes.fr/rocket/'
    authentication_uri: 'https://sso.theia-land.fr/commonauth'
    token_uri: 'https://theia-landsat.cnes.fr/resto/api/auth/theia'
    client_id: 'ZYhcLtyuDM0f2BMH1bIF1Fc2neQa'
    token_exchange_params:
      redirect_uri: redirectUri
      client_id: clientId
    token_exchange_post_data_method: json
    token_provision: qs
    token_qs_key: '_bearer'
    token_key: 'token'

---
!provider
  name: theia
  priority: 0
  search: !plugin
    type: RestoSearch
    api_endpoint: 'https://theia.cnes.fr/atdistrib/resto2/api'
    product_location_scheme: https
    metadata_mapping:
      id: '$.id'
      geometry:
        - box
        - '$.geometry'
      productType:
        - productType
        - '$.properties.productType'
      platformSerialIdentifier: '$.properties.platform'
      instrument: '$.properties.instrument'
      processingLevel: '$.properties.processingLevel'
      title: '$.properties.title'
      keyword: '$.properties.keywords'
      organisationName: '$.properties.organisationName'
      orbitNumber: '$.properties.orbitNumber'
      orbitDirection: '$.properties.orbitDirection'
      cloudCover:
        - cloudCover
        - '$.properties.cloudCover'
      snowCover: '$.properties.snowCover'
      startTimeFromAscendingNode:
        - startDate
        - '$.properties.startDate'
      completionTimeFromAscendingNode:
        - completionDate
        - '$.properties.completionDate'
      parentIdentifier: '$.properties.parentIdentifier'
      resolution: '$.properties.resolution'
      sensorMode: '$.properties.sensorMode'
      productVersion: '$.properties.version'
      quicklook: '$.properties.quicklook'
  products:
    S2_MSI_L2A:
      product_type: REFLECTANCE
      collection: SENTINEL2
  download: !plugin
    type: HTTPDownload
    base_uri: 'https://theia.cnes.fr/atdistrib/resto2'
    extract: true
    dl_url_params:
      issuerId: theia
  auth: !plugin
    type: TokenAuth
    auth_uri: 'https://theia.cnes.fr/atdistrib/services/authenticate/'

---
!provider
  name: peps
  priority: 1
  search: !plugin
    type: RestoSearch
    api_endpoint: 'https://peps.cnes.fr/resto/api'
    product_location_scheme: https
    metadata_mapping:
      id: '$.id'
      geometry:
        - box
        - '$.geometry'
      productType:
        - productType
        - '$.properties.productType'
      platform: '$.properties.collection'
      platformSerialIdentifier: '$.properties.platform'
      instrument: '$.properties.instrument'
      processingLevel: '$.properties.processingLevel'
      title: '$.properties.title'
      keyword: '$.properties.keywords'
      abstract: '$.properties.description'
      organisationName: '$.properties.organisationName'
      orbitNumber: '$.properties.orbitNumber'
      orbitDirection: '$.properties.orbitDirection'
      cloudCover:
        - cloudCover
        - '$.properties.cloudCover'
      snowCover: '$.properties.snowCover'
      startTimeFromAscendingNode:
        - startDate
        - '$.properties.startDate'
      completionTimeFromAscendingNode:
        - completionDate
        - '$.properties.completionDate'
      parentIdentifier: '$.properties.parentIdentifier'
      resolution: '$.properties.resolution'
      sensorMode: '$.properties.sensorMode'
      quicklook: '$.properties.quicklook'
  products:
    S1_SAR_OCN:
      product_type: OCN
      collection: S1
    S1_SAR_GRD:
      product_type: GRD
      collection: S1
    S1_SAR_SLC:
      product_type: SLC
      collection: S1
    S2_MSI_L1C:
      collection: S2ST
      product_type: S2MSI1C
      partial: false   # Peps only provide L1C products for Sentinel-2A platform
    S3_EFR:
      product_type: OL_1_EFR___
      collection: S3
    S3_ERR:
      product_type: OL_1_ERR___
      collection: S3
    S3_OLCI_L2LFR:
      product_type: OL_2_LFR___
      collection: S3
    S3_OLCI_L2LRR:
      product_type: OL_2_LRR___
      collection: S3
    S3_SLSTR_L1RBT:
      product_type: SL_1_RBT___
      collection: S3
    S3_SLSTR_L2LST:
      product_type: SL_2_LST___
      collection: S3
    S3_LAN:
      product_type: SR_2_LAN___
      collection: S3
  download: !plugin
    type: HTTPDownload
    base_uri: 'https://peps.cnes.fr/resto'
    extract: true
    archive_depth: 2
    dl_url_params:
      issuerId: peps
  auth: !plugin
    type: GenericAuth
    auth_uri: 'https://peps.cnes.fr/resto/api/users/connect'

---
!provider
  name: sobloo
  priority: 0
  products:
    S2_MSI_L1C:
      product_type: S2MSI1C
      partial: true
    S1_SAR_RAW:
      product_type: RAW
      partial: true
    S1_SAR_GRD:
      product_type: GRD
      partial: true
    S1_SAR_SLC:
      product_type: SLC
      partial: true
    S1_SAR_OCN:
      product_type: OCN
      partial: true
    S3_LAN:
      product_type: SR_2_LAN___
    S3_SRA:
      product_type: SR_1_SRA___
    S3_SRA_BS:
      product_type: SR_1_SRA_BS
    S3_SRA_A_BS:
      product_type: SR_1_SRA_A_
  search: !plugin
    type: ArlasSearch
    api_endpoint: 'https://sobloo.eu/api/v1/services/explore'
    quicklook_endpoint: 'https://sobloo.eu/api/v1/services/quicklook'
    arlas_collection: catalog
    metadata_mapping:
      id: '$.properties.uid'
      geometry:
        - gintersect
        - '$.geometry'
      productType:
        - 'identification.type'
        - '$.properties.identification.type'
      platform: '$.properties.acquisition.mission'
      platformSerialIdentifier: '$.properties.acquisition.missionCode'
      instrument: '$.properties.acquisition.sensorId'
      processingLevel: '$.properties.production.levelCode'
      title: '$.properties.identification.externalId'
      orbitNumber: '$.properties.orbit.number'
      orbitDirection: '$.properties.orbit.direction'
      cloudCover:
        - 'contentDesctiption.cloudCoverPercentage'
        - '$.properties.contentDescription.cloudCoverPercentage'
      startTimeFromAscendingNode:
        - 'acquisition.beginViewingDate'
        - '$.properties.acquisition.beginViewingDate'
      completionTimeFromAscendingNode: '$.properties.acquisition.endViewingDate'
      quicklook: '$.properties.state.resources.quicklook'
  download: !plugin
    type: HTTPDownload
    base_uri: 'https://sobloo.eu/api/v1/services/download/'
    archive_depth: 2
    extract: true
  auth: !plugin
    type: HTTPHeaderAuth
    headers:
      Authorization: "Apikey {apikey}"

---
!provider
  name: creodias
  priority: 0
  search: !plugin
    type: RestoSearch
    api_endpoint: 'https://finder.creodias.eu/resto/api/'
    product_location_scheme: 'https'
    metadata_mapping:
      id: '$.id'
      geometry:
        - box
        - '$.geometry'
      productType:
        - productType
        - '$.properties.productType'
      platform: '$.properties.collection'
      platformSerialIdentifier: '$.properties.platform'
      instrument: '$.properties.instrument'
      processingLevel: '$.properties.processingLevel'
      title: '$.properties.title'
      keyword: '$.properties.keywords'
      abstract: '$.properties.description'
      organisationName: '$.properties.organisationName'
      orbitNumber: '$.properties.orbitNumber'
      orbitDirection: '$.properties.orbitDirection'
      cloudCover:
        - cloudCover
        - '$.properties.cloudCover'
      snowCover: '$.properties.snowCover'
      startTimeFromAscendingNode:
        - startDate
        - '$.properties.startDate'
      completionTimeFromAscendingNode:
        - completionDate
        - '$.properties.completionDate'
      parentIdentifier: '$.properties.parentIdentifier'
      resolution: '$.properties.resolution'
      sensorMode: '$.properties.sensorMode'
      quicklook: '$.properties.thumbnail'
  download: !plugin
    type: HTTPDownload
    base_uri: 'https://zipper.creodias.eu/download/'
    extract: true
  auth: !plugin
    type: KeycloakOIDCPasswordAuth
    auth_base_uri: 'https://auth.creodias.eu/auth'
    realm: 'dias'
    client_id: 'CLOUDFERRO_PARTNERS'
    client_secret: 'dc0aca03-2dc6-4798-a5de-fc5aeb6c8ee1'
    token_provision: qs
    token_qs_key: 'token'
  products:
    S2_MSI_L1C:
      product_type: L1C
      collection: Sentinel2
    S2_MSI_L2A:
      product_type: L2A
      collection: Sentinel2
    S1_SAR_RAW:
      product_type: RAW
      collection: Sentinel1
    S1_SAR_GRD:
      product_type: GRD
      collection: Sentinel1
    S1_SAR_SLC:
      product_type: SLC
      collection: Sentinel1
    S1_SAR_OCN:
      product_type: OCN
      collection: Sentinel1
    S3_LAN:
      product_type: LAN
      collection: Sentinel3
    S3_SRA:
      product_type: SRA
      collection: Sentinel3
    S3_SRA_BS:
      product_type: SRA_BS
      collection: Sentinel3
    S3_SRA_A_BS:
      product_type: SRA_A
      collection: Sentinel3
    S3_EFR:
      product_type: EFR
      collection: Sentinel3
    S3_ERR:
      product_type: ERR
      collection: Sentinel3
    S3_WAT:
      product_type: WAT
      collection: Sentinel3
    S3_SLSTR_L2LST:
      product_type: LST
      collection: Sentinel3
    S3_OLCI_L2LRR:
      product_type: LRR
      collection: Sentinel3
    S3_OLCI_L2LFR:
      product_type: LFR
      collection: Sentinel3
    S3_SLSTR_L1RBT:
      product_type: RBT
      collection: Sentinel3

---
!provider
  name: mundi_s1
  priority: 0
  search: !plugin
    type: CSWSearch
    api_endpoint: 'https://mundiwebservices.com/acdc/catalog/proxy/search/Sentinel1/csw'
    metadata_mapping:
      id: 'dc:identifier/text()'
      productType: 'DIAS:productType/text()'
      geometry: 'DIAS:footprint/text()'
      processingLevel: 'DIAS:productLevel/text()'
      title: 'dc:title/text()'
      abstract: 'dct:abstract/text()'
      orbitNumber: 'DIAS:acquisitionOrbitNumber/text()'
      orbitDirection: 'DIAS:orbitDirection/text()'
      startTimeFromAscendingNode: 'DIAS:sensingStartDate/text()'
      completionTimeFromAscendingNode: 'DIAS:sensingStopDate/text()'
      resolution: 'DIAS:resolution/text()'
      sensorMode: 'DIAS:sensorMode/text()'
      quicklook: 'DIAS:quicklookURI/text()'
    search_definition:
      product_type_tags:
        - name: 'DIAS:productType' # any xml tag of the catalogue that can be queryable
          matching: exact # One of exact (eq. to L1C for ex), prefix (eq. *L1C), postfix (eq. L1C*) or fuzzy (eq. *L1C*)
      date_tags:
        start: 'DIAS:sensingStartDate'
        end: 'DIAS:sensingStopDate'
  download: !plugin
    type: HTTPDownload
  auth: !plugin
    type: GenericAuth
  products:
    S1_SAR_RAW: RAW
    S1_SAR_GRD: GRD
    S1_SAR_SLC: SLC
    S1_SAR_OCN: OCN

---
!provider
  name: mundi_s2
  priority: 0
  search: !plugin
    type: CSWSearch
    api_endpoint: 'https://mundiwebservices.com/acdc/catalog/proxy/search/Sentinel2/csw'
    metadata_mapping:
      id: 'dc:identifier/text()'
      productType: 'DIAS:productType/text()'
      geometry: 'DIAS:footprint/text()'
      processingLevel: 'DIAS:productLevel/text()'
      title: 'dc:title/text()'
      abstract: 'dct:abstract/text()'
      orbitNumber: 'DIAS:acquisitionOrbitNumber/text()'
      orbitDirection: 'DIAS:orbitDirection/text()'
      startTimeFromAscendingNode: 'DIAS:sensingStartDate/text()'
      completionTimeFromAscendingNode: 'DIAS:sensingStopDate/text()'
      resolution: 'DIAS:resolution/text()'
      sensorMode: 'DIAS:sensorMode/text()'
      quicklook: 'DIAS:quicklookURI/text()'
    search_definition:
      product_type_tags:
        - name: 'DIAS:productType' # any xml tag of the catalogue that can be queryable
          matching: exact # One of exact (eq. to L1C for ex), prefix (eq. *L1C), postfix (eq. L1C*) or fuzzy (eq. *L1C*)
      date_tags:
        start: 'DIAS:sensingStartDate'
        end: 'DIAS:sensingStopDate'
  download: !plugin
    type: HTTPDownload
  auth: !plugin
    type: GenericAuth
  products:
    S2_MSI_L1C: L1C
    S2_MSI_L2A: L2A