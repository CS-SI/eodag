# -*- coding: utf-8 -*-
# Copyright 2018, CS Systemes d'Information, http://www.c-s.fr
#
# This file is part of EODAG project
#     https://www.github.com/CS-SI/EODAG
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
!provider
  name: usgs
  priority: 0
  api: !plugin
    type: UsgsApi
    google_base_url: 'http://storage.googleapis.com/earthengine-public/landsat/'
    metadata_mapping:
      id: '$.entityId'
      geometry: '$.geometry'
      productType: '$.productType'
      title: '$.displayId'
      abstract: '$.summary'
      startTimeFromAscendingNode: '$.startTime'
      completionTimeFromAscendingNode: '$.endTime'
      quicklook: '$.browserUrl'
    extract: True
  products:
    L8_OLI_TIRS_C1L1:
      dataset: LANDSAT_8_C1
      catalog_node: EE  # Possible values: CWIC, EE, HDDS, LPCS

---
!provider
  name: aws_s3_sentinel2_l1c
  priority: 0
  search: !plugin
    type: AwsSearch
    api_endpoint: 'http://finder.eocloud.eu/resto/api/collections/{collection}/search.json'
    pagination:
      next_page_url_tpl: '{url}?{search}&maxRecords={items_per_page}&page={page}'
      total_items_nb_key_path: '$.properties.totalResults'
    metadata_mapping:
      id: '$.id'
      geometry:
        - 'box={geometry[lonmin]},{geometry[latmin]},{geometry[lonmax]},{geometry[latmax]}'
        - '$.geometry'
      productType:
        - productType
        - '$.properties.productType'
      platform: '$.properties.collection'
      platformSerialIdentifier: '$.properties.platform'
      instrument: '$.properties.instrument'
      processingLevel: '$.properties.processingLevel'
      title: '$.properties.title'
      keyword: '$.properties.keywords'
      abstract: '$.properties.description'
      organisationName: '$.properties.organisationName'
      orbitNumber: '$.properties.orbitNumber'
      orbitDirection: '$.properties.orbitDirection'
      cloudCover:
        - 'cloudCover=[0,{cloudCover}]'
        - '$.properties.cloudCover'
      snowCover: '$.properties.snowCover'
      startTimeFromAscendingNode:
        - startDate
        - '$.properties.startDate'
      completionTimeFromAscendingNode:
        - completionDate
        - '$.properties.completionDate'
      parentIdentifier: '$.properties.parentIdentifier'
      resolution: '$.properties.resolution'
      sensorMode: '$.properties.sensorMode'
      quicklook: '$.properties.quicklook'

      # INSPIRE obligated OpenSearch Parameters for Collection Search (Table 4)
      publicationDate: '$.properties.published'
      accessConstraint: '$.properties.license'

      # OpenSearch Parameters for Product Search (Table 5)
      productionStatus: '$.properties.status'
      creationDate: '$.properties.published'
      modificationDate: '$.properties.updated'
  products:
    S2_MSI_L1C:
      product_type: L1C
      collection: Sentinel2
  download: !plugin
    type: AwsDownload
    associated_bucket: 'sentinel-s2-l1c'
  auth: !plugin
    type: OAuth

---
!provider
  name: theia_landsat
  priority: 0
  products:
    LS_REFLECTANCE:
      collection: Landsat
      product_type: REFLECTANCE
    LS_REFLECTANCETOA:
      collection: Landsat
      product_type: REFLECTANCETOA
    PLD_REFLECTANCE:
      collection: Pleiades
      product_type: REFLECTANCE
    PLD_REFLECTANCETOA:
      collection: Pleiades
      product_type: REFLECTANCETOA
    PLD_BUNDLE:
      collection: Pleiades
      product_type: Bundle (Pan, XS)
  search: !plugin
    type: QueryStringSearch
    api_endpoint: 'https://theia-landsat.cnes.fr/resto/api/collections/{collection}/search.json'
    pagination:
      next_page_url_tpl: '{url}?{search}&maxRecords={items_per_page}&page={page}'
      total_items_nb_key_path: '$.properties.totalResults'
    metadata_mapping:
      # OpenSearch Parameters for Collection Search (Table 3)
      productType:
        - productType
        - '$.properties.productType'
      doi: '$.properties.doi'
      platform: '$.properties.collection'
      platformSerialIdentifier: '$.properties.platform'
      instrument: '$.properties.instrument'
      sensorType: '$.properties.sensorType'
      compositeType: '$.properties.compositeType'
      processingLevel: '$.properties.processingLevel'
      orbitType: '$.properties.orbitType'
      spectralRange: '$.properties.spectralRange'
      wavelengths: '$.properties.wavelengths'
      hasSecurityConstraints: '$.properties.hasSecurityConstraints'
      dissemination: '$.properties.dissemination'

      # INSPIRE obligated OpenSearch Parameters for Collection Search (Table 4)
      title: '$.properties.title'
      topicCategory: '$.properties.topicCategory'
      keyword: '$.properties.keywords'
      abstract: '$.properties.abstract'
      resolution: '$.properties.resolution'
      organisationName: '$.properties.organisationName'
      organisationRole: '$.properties.organisationRole'
      publicationDate: '$.properties.publicationDate'
      lineage: '$.properties.lineage'
      useLimitation: '$.properties.useLimitation'
      accessConstraint: '$.properties.accessConstraint'
      otherConstraint: '$.properties.otherConstraint'
      classification: '$.properties.classification'
      language: '$.properties.language'
      specification: '$.properties.specification'

      # OpenSearch Parameters for Product Search (Table 5)
      parentIdentifier: '$.properties.parentIdentifier'
      productionStatus: '$.properties.productionStatus'
      acquisitionType: '$.properties.acquisitionType'
      orbitNumber: '$.properties.orbitNumber'
      orbitDirection: '$.properties.orbitDirection'
      track: '$.properties.track'
      frame: '$.properties.frame'
      swathIdentifier: '$.properties.swathIdentifier'
      cloudCover:
        - 'cloudCover=[0,{cloudCover}]'
        - '$.properties.cloudCover'
      snowCover: '$.properties.snowCover'
      lowestLocation: '$.properties.lowestLocation'
      highestLocation: '$.properties.highestLocation'
      productVersion: '$.properties.version'
      productQualityStatus: '$.properties.productQualityStatus'
      productQualityDegradationTag: '$.properties.productQualityDegradationTag'
      processorName: '$.properties.processorName'
      processingCenter: '$.properties.processingCenter'
      creationDate: '$.properties.creationDate'
      modificationDate: '$.properties.modificationDate'
      processingDate: '$.properties.processingDate'
      sensorMode: '$.properties.sensorMode'
      archivingCenter: '$.properties.archivingCenter'
      processingMode: '$.properties.processingMode'

      # OpenSearch Parameters for Acquistion Parameters Search (Table 6)
      availabilityTime: '$.properties.availabilityTime'
      acquisitionStation: '$.properties.acquisitionStation'
      acquisitionSubType: '$.properties.acquisitionSubType'
      startTimeFromAscendingNode:
        - startDate
        - '$.properties.startDate'
      completionTimeFromAscendingNode:
        - completionDate
        - '$.properties.completionDate'
      illuminationAzimuthAngle: '$.properties.illuminationAzimuthAngle'
      illuminationZenithAngle: '$.properties.illuminationZenithAngle'
      illuminationElevationAngle: '$.properties.illuminationElevationAngle'
      polarizationMode: '$.properties.polarizationMode'
      polarisationChannels: '$.properties.polarisationChannels'
      antennaLookDirection: '$.properties.antennaLookDirection'
      minimumIncidenceAngle: '$.properties.minimumIncidenceAngle'
      maximumIncidenceAngle: '$.properties.maximumIncidenceAngle'
      dopplerFrequency: '$.properties.dopplerFrequency'
      incidenceAngleVariation: '$.properties.incidenceAngleVariation'

      # Custom parameters (not defined in the base document referenced above)
      id: '$.id'
      # The geographic extent of the product
      geometry:
        - 'box={geometry[lonmin]},{geometry[latmin]},{geometry[lonmax]},{geometry[latmax]}'
        - '$.geometry'
      # The url of the quicklook
      quicklook: '$.properties.quicklook'
      # The url to download the product "as is" (literal or as a template to be completed either after the search result
      # is obtained from the provider or during the eodag download phase)
      downloadLink: '$.properties.services.download.url'
  download: !plugin
    type: HTTPDownload
    base_uri: 'https://theia-landsat.cnes.fr/resto'
    extract: true
  auth: !plugin
    type: OIDCAuthorizationCodeFlowAuth
    login_form_xpath: '//form[@id="loginForm"]'
    authentication_uri_source: 'config'
    additional_login_form_data:
      sessionDataKey:  'xpath(//input[@name="sessionDataKey"]/@value)'
    user_consent_needed: True
    user_consent_form_xpath: '//form[@id="profile"]'
    user_consent_form_data:
      consent: 'approve'
      sessionDataKeyConsent: 'xpath(//input[@name="sessionDataKeyConsent"]/@value)'
    authorization_uri: 'https://sso.theia-land.fr/oauth2/authorize'
    redirect_uri: 'https://theia-landsat.cnes.fr/rocket/'
    authentication_uri: 'https://sso.theia-land.fr/commonauth'
    token_uri: 'https://theia-landsat.cnes.fr/resto/api/auth/theia'
    client_id: 'ZYhcLtyuDM0f2BMH1bIF1Fc2neQa'
    token_exchange_params:
      redirect_uri: redirectUri
      client_id: clientId
    token_exchange_post_data_method: json
    token_provision: qs
    token_qs_key: '_bearer'
    token_key: 'token'

---
!provider
  name: theia
  priority: 0
  search: !plugin
    type: QueryStringSearch
    api_endpoint: 'https://theia.cnes.fr/atdistrib/resto2/api/collections/{collection}/search.json'
    pagination:
      next_page_url_tpl: '{url}?{search}&maxRecords={items_per_page}&page={page}'
      total_items_nb_key_path: '$.properties.totalResults'
    metadata_mapping:
      # OpenSearch Parameters for Collection Search (Table 3)
      productType:
        - productType
        - '$.properties.productType'
      platform: '$.properties.collection'
      platformSerialIdentifier: '$.properties.platform'
      instrument: '$.properties.instrument'
      processingLevel: '$.properties.processingLevel'

      # INSPIRE obligated OpenSearch Parameters for Collection Search (Table 4)
      title: '$.properties.title'
      keyword: '$.properties.keywords'
      resolution: '$.properties.resolution'
      organisationName: '$.properties.organisationName'
      publicationDate: '$.properties.published'
      accessConstraint: '$.properties.license'

      # OpenSearch Parameters for Product Search (Table 5)
      parentIdentifier: '$.properties.parentIdentifier'
      orbitNumber: '$.properties.orbitNumber'
      cloudCover:
        - 'cloudCover=[0,{cloudCover}]'
        - '$.properties.cloudCover'
      snowCover: '$.properties.snowCover'
      productVersion: '$.properties.version'
      creationDate: '$.properties.productionDate'
      modificationDate: '$.properties.modificationDate'
      processingDate: '$.properties.processingDate'
      sensorMode: '$.properties.sensorMode'
      archivingCenter: '$.properties.archivingCenter'
      processingMode: '$.properties.processingMode'

      # OpenSearch Parameters for Acquistion Parameters Search (Table 6)
      availabilityTime: '$.properties.availabilityTime'
      acquisitionStation: '$.properties.acquisitionStation'
      acquisitionSubType: '$.properties.acquisitionSubType'
      startTimeFromAscendingNode:
        - 'startDate={startTimeFromAscendingNode#to_iso_date}'
        - '$.properties.startDate'
      completionTimeFromAscendingNode:
        - 'completionDate={completionTimeFromAscendingNode#to_iso_date}'
        - '$.properties.completionDate'
      illuminationAzimuthAngle: '$.properties.illuminationAzimuthAngle'
      illuminationZenithAngle: '$.properties.illuminationZenithAngle'
      illuminationElevationAngle: '$.properties.illuminationElevationAngle'
      polarizationMode: '$.properties.polarizationMode'
      polarisationChannels: '$.properties.polarisationChannels'
      antennaLookDirection: '$.properties.antennaLookDirection'
      minimumIncidenceAngle: '$.properties.minimumIncidenceAngle'
      maximumIncidenceAngle: '$.properties.maximumIncidenceAngle'
      dopplerFrequency: '$.properties.dopplerFrequency'
      incidenceAngleVariation: '$.properties.incidenceAngleVariation'

      # Custom parameters (not defined in the base document referenced above)
      id: '$.id'
      # The geographic extent of the product
      geometry:
        - 'box={geometry[lonmin]},{geometry[latmin]},{geometry[lonmax]},{geometry[latmax]}'
        - '$.geometry'
      # The url of the quicklook
      quicklook: '$.properties.quicklook'
      # The url to download the product "as is" (literal or as a template to be completed either after the search result
      # is obtained from the provider or during the eodag download phase)
      downloadLink: '$.properties.services.download.url'

      # Additional metadata provided by the providers but that don't appear in the reference spec
      # Or has a different signification for the provider
      relativeOrbitNumber: '$.properties.relativeOrbitNumber'
      waterCover: '$.properties.waterCover'
      centroid: '$.properties.centroid'
      percentSaturatedPixelsMax: '$.properties.percentSaturatedPixelsMax'
      percentNoDataPixelsMax: '$.properties.percentNoDataPixelsMax'
      nbColInterpolationErrorMax: '$.properties.nbColInterpolationErrorMax'
      percentGroundUsefulPixels: '$.properties.percentGroundUsefulPixels'
      percentUsefulPixelsMin: '$.properties.percentUsefulPixelsMin'
      location: '$.properties.location'
      bands: '$.properties.bands'
      thermBands: '$.properties.thermBands'
      nb_cols: '$.properties.nb_cols'
      nb_rows: '$.properties.nb_rows'
      tileId: '$.properties.tileId'
      thumbnail: '$.properties.thumbnail'
  products:
    S2_MSI_L2A:
      product_type: REFLECTANCE
      collection: SENTINEL2
  download: !plugin
    type: HTTPDownload
    base_uri: 'https://theia.cnes.fr/atdistrib/resto2'
    extract: true
    dl_url_params:
      issuerId: theia
  auth: !plugin
    type: TokenAuth
    auth_uri: 'https://theia.cnes.fr/atdistrib/services/authenticate/'

---
!provider
  name: peps
  priority: 1
  search: !plugin
    type: QueryStringSearch
    api_endpoint: 'https://peps.cnes.fr/resto/api/collections/{collection}/search.json'
    pagination:
      next_page_url_tpl: '{url}?{search}&maxRecords={items_per_page}&page={page}'
      total_items_nb_key_path: '$.properties.totalResults'
    metadata_mapping:
      # OpenSearch Parameters for Collection Search (Table 3)
      productType:
        - productType
        - '$.properties.productType'
      platform: '$.properties.collection'
      platformSerialIdentifier: '$.properties.platform'
      instrument: '$.properties.instrument'
      processingLevel: '$.properties.processingLevel'

      # INSPIRE obligated OpenSearch Parameters for Collection Search (Table 4)
      title: '$.properties.title'
      topicCategory: '$.properties.topicCategory'
      keyword: '$.properties.keywords'
      abstract: '$.properties.description'
      resolution: '$.properties.resolution'
      organisationName: '$.properties.organisationName'
      publicationDate: '$.properties.published'
      accessConstraint: '$.properties.license'

      # OpenSearch Parameters for Product Search (Table 5)
      parentIdentifier: '$.properties.parentIdentifier'
      productionStatus: '$.properties.status'
      acquisitionType: '$.properties.acquisitionType'
      orbitNumber: '$.properties.orbitNumber'
      orbitDirection: '$.properties.orbitDirection'
      swathIdentifier: '$.properties.swath'
      cloudCover:
        - 'cloudCover=[0,{cloudCover}]'
        - '$.properties.cloudCover'
      snowCover: '$.properties.snowCover'
      productVersion: '$.properties.version'
      productQualityStatus: '$.properties.onlineQualityCheck'
      processorName: '$.properties.processingName'
      processingCenter: '$.properties.processingCenter'
      creationDate: '$.properties.dhusIngestDate'
      modificationDate: '$.properties.updated'
      sensorMode: '$.properties.sensorMode'

      # OpenSearch Parameters for Acquistion Parameters Search (Table 6)
      startTimeFromAscendingNode:
        - startDate
        - '$.properties.startDate'
      completionTimeFromAscendingNode:
        - completionDate
        - '$.properties.completionDate'
      polarizationMode: '$.properties.polarisation'

      # Custom parameters (not defined in the base document referenced above)
      id: '$.id'
      # The geographic extent of the product
      geometry:
        - 'box={geometry[lonmin]},{geometry[latmin]},{geometry[lonmax]},{geometry[latmax]}'
        - '$.geometry'
      # The url of the quicklook
      quicklook: '$.properties.quicklook'
      # The url to download the product "as is" (literal or as a template to be completed either after the search result
      # is obtained from the provider or during the eodag download phase)
      downloadLink: '$.properties.services.download.url'

      # Additional metadata provided by the providers but that don't appear in the reference spec
      # Or has a different signification for the provider
      relativeOrbitNumber: '$.properties.relativeOrbitNumber'
      water: '$.properties.water'
      centroid: '$.properties.centroid'
      thumbnail: '$.properties.thumbnail'
      s2TakeId: '$.properties.s2TakeId'
      storage: '$.properties.storage'
      realtime: '$.properties.realtime'
      visible: '$.properties.visible'
      isNrt: '$.properties.isNrt'
      resourceChecksum: '$.properties.resourceChecksum'
      resourceSize: '$.properties.resourceSize'
      snowIce: '$.properties.snowIce'
      vegetation: '$.properties.vegetation'
      bareSoil: '$.properties.bareSoil'
      highProbaClouds: '$.properties.highProbaClouds'
      mediumProbaClouds: '$.properties.mediumProbaClouds'
      lowProbaClouds: '$.properties.lowProbaClouds'
      mgrs: '$.properties.mgrs'
      newVersion: '$.properties.newVersion'
      missionTakeId: '$.properties.missionTakeId'
      cycleNumber: '$.properties.cycleNumber'
      approxSize: '$.properties.approxSize'
      ecmwfType: '$.properties.ecmwfType'
  products:
    S1_SAR_OCN:
      product_type: OCN
      collection: S1
    S1_SAR_GRD:
      product_type: GRD
      collection: S1
    S1_SAR_SLC:
      product_type: SLC
      collection: S1
    S2_MSI_L1C:
      collection: S2ST
      product_type: S2MSI1C
    S3_EFR:
      product_type: OL_1_EFR___
      collection: S3
    S3_ERR:
      product_type: OL_1_ERR___
      collection: S3
    S3_OLCI_L2LFR:
      product_type: OL_2_LFR___
      collection: S3
    S3_OLCI_L2LRR:
      product_type: OL_2_LRR___
      collection: S3
    S3_SLSTR_L1RBT:
      product_type: SL_1_RBT___
      collection: S3
    S3_SLSTR_L2LST:
      product_type: SL_2_LST___
      collection: S3
    S3_LAN:
      product_type: SR_2_LAN___
      collection: S3
  download: !plugin
    type: HTTPDownload
    base_uri: 'https://peps.cnes.fr/resto'
    extract: true
    archive_depth: 2
    dl_url_params:
      issuerId: peps
  auth: !plugin
    type: GenericAuth
    auth_uri: 'https://peps.cnes.fr/resto/api/users/connect'

---
!provider
  name: sobloo
  priority: 0
  products:
    S2_MSI_L1C:
      product_type: S2MSI1C
    S1_SAR_RAW:
      product_type: RAW
    S1_SAR_GRD:
      product_type: GRD
    S1_SAR_SLC:
      product_type: SLC
    S1_SAR_OCN:
      product_type: OCN
    S3_LAN:
      product_type: SR_2_LAN___
    S3_SRA:
      product_type: SR_1_SRA___
    S3_SRA_BS:
      product_type: SR_1_SRA_BS
    S3_SRA_A_BS:
      product_type: SR_1_SRA_A_
  search: !plugin
    type: QueryStringSearch
    api_endpoint: 'https://sobloo.eu/api/v1/services/explore/explore/{collection}/_geosearch'
    collection: catalog
    result_type: 'json'
    pagination:
      count_endpoint: 'https://sobloo.eu/api/v1/services/explore/explore/{collection}/_count'
      next_page_url_tpl: '{url}?{search}&size={items_per_page}&from={page}'
      total_items_nb_key_path: '$.totalnb'
    metadata_mapping:
      # OpenSearch Parameters for Collection Search (Table 3)
      productType:
        - 'f=identification.type:eq:{productType}'
        - '$.properties.identification.type'
      platform: '$.properties.acquisition.mission'
      platformSerialIdentifier: '$.properties.acquisition.missionCode'
      instrument: '$.properties.acquisition.sensorId'
      processingLevel: '$.properties.production.levelCode'

      # INSPIRE obligated OpenSearch Parameters for Collection Search (Table 4)
      title: '$.properties.identification.externalId'
      publicationDate: '{$.properties.timestamp#to_iso_utc_datetime_from_milliseconds}'

      # OpenSearch Parameters for Product Search (Table 5)
      orbitNumber: '$.properties.orbit.number'
      orbitDirection: '$.properties.orbit.direction'
      cloudCover:
        - 'contentDescription.cloudCoverPercentage:range:0,{cloudCover}'
        - '$.properties.contentDescription.cloudCoverPercentage'
      creationDate: '{$.properties.state.insertionDate#to_iso_utc_datetime_from_milliseconds}'

      # OpenSearch Parameters for Acquistion Parameters Search (Table 6)
      availabilityTime: '$.properties.availabilityTime'
      startTimeFromAscendingNode:
        - 'f=acquisition.beginViewingDate:gte:{startTimeFromAscendingNode#to_timestamp_milliseconds}'
        - '{$.properties.acquisition.beginViewingDate#to_iso_utc_datetime_from_milliseconds}'
      completionTimeFromAscendingNode:
        - 'f=acquisition.endViewingDate:lte:{completionTimeFromAscendingNode#to_timestamp_milliseconds}'
        - '{$.properties.acquisition.endViewingDate#to_iso_utc_datetime_from_milliseconds}'

      # Custom parameters (not defined in the base document referenced above)
      id: '$.properties.uid'
      # The geographic extent of the product
      geometry:
        - 'gintersect={geometry[lonmin]},{geometry[latmin]},{geometry[lonmax]},{geometry[latmax]}'
        - '$.geometry'
      # The url of the quicklook
      quicklook: 'https://sobloo.eu/api/v1/services/quicklook/{id}'
      # The url to download the product "as is" (literal or as a template to be completed either after the search result
      # is obtained from the provider or during the eodag download phase)
      downloadLink: '%(base_uri)s/{id}'

      # Additional metadata provided by the providers but that don't appear in the reference spec
      visibility: '$.properties.visibility'
      archive: '$.properties.archive'
      centroid: '$.properties.spatialCoverage.geometry.centerPoint'
      enrichment: '$.properties.enrichment'
      relativeOrbitNumber: '$.properties.orbit.relativeNumber'
  download: !plugin
    type: HTTPDownload
    base_uri: 'https://sobloo.eu/api/v1/services/download'
    archive_depth: 2
    extract: true
  auth: !plugin
    type: HTTPHeaderAuth
    headers:
      Authorization: "Apikey {apikey}"

---
!provider
  name: creodias
  priority: 0
  search: !plugin
    type: QueryStringSearch
    api_endpoint: 'https://finder.creodias.eu/resto/api/collections/{collection}/search.json'
    pagination:
      next_page_url_tpl: '{url}?{search}&maxRecords={items_per_page}&page={page}'
      total_items_nb_key_path: '$.properties.totalResults'
    metadata_mapping:
      # OpenSearch Parameters for Collection Search (Table 3)
      productType:
        - productType
        - '$.properties.productType'
      platform: '$.properties.collection'
      platformSerialIdentifier: '$.properties.platform'
      instrument: '$.properties.instrument'
      processingLevel: '$.properties.processingLevel'

      # INSPIRE obligated OpenSearch Parameters for Collection Search (Table 4)
      title: '$.properties.title'
      keyword: '$.properties.keywords'
      abstract: '$.properties.description'
      resolution: '$.properties.resolution'
      organisationName: '$.properties.organisationName'
      publicationDate: '$.properties.published'
      accessConstraint: '$.properties.license'

      # OpenSearch Parameters for Product Search (Table 5)
      parentIdentifier: '$.properties.parentIdentifier'
      productionStatus: '$.properties.status'
      orbitNumber: '$.properties.orbitNumber'
      orbitDirection: '$.properties.orbitDirection'
      cloudCover:
        - 'cloudCover=[0,{cloudCover}]'
        - '$.properties.cloudCover'
      snowCover: '$.properties.snowCover'
      modificationDate: '$.properties.updated'
      sensorMode: '$.properties.sensorMode'

      # OpenSearch Parameters for Acquistion Parameters Search (Table 6)
      startTimeFromAscendingNode:
        - startDate
        - '$.properties.startDate'
      completionTimeFromAscendingNode:
        - completionDate
        - '$.properties.completionDate'

      # Custom parameters (not defined in the base document referenced above)
      id: '$.id'
      # The geographic extent of the product
      geometry:
        - 'box={geometry[lonmin]},{geometry[latmin]},{geometry[lonmax]},{geometry[latmax]}'
        - '$.geometry'
      # The url of the quicklook
      quicklook: '$.properties.quicklook'
      # The url to download the product "as is" (literal or as a template to be completed either after the search result
      # is obtained from the provider or during the eodag download phase)
      downloadLink: '$.properties.services.download.url'

      # Additional metadata provided by the providers but that don't appear in the reference spec
      thumbnail: '$.properties.thumbnail'
      gmlgeometry: '$.properties.gmlgeometry'
      centroid: '$.properties.centroid'
      missionTakeId: '$.properties.missionTakeId'
  download: !plugin
    type: HTTPDownload
    base_uri: 'https://zipper.creodias.eu/download/'
    extract: true
  auth: !plugin
    type: KeycloakOIDCPasswordAuth
    auth_base_uri: 'https://auth.creodias.eu/auth'
    realm: 'dias'
    client_id: 'CLOUDFERRO_PARTNERS'
    client_secret: 'dc0aca03-2dc6-4798-a5de-fc5aeb6c8ee1'
    token_provision: qs
    token_qs_key: 'token'
  products:
    S2_MSI_L1C:
      product_type: L1C
      collection: Sentinel2
    S2_MSI_L2A:
      product_type: L2A
      collection: Sentinel2
    S1_SAR_RAW:
      product_type: RAW
      collection: Sentinel1
    S1_SAR_GRD:
      product_type: GRD
      collection: Sentinel1
    S1_SAR_SLC:
      product_type: SLC
      collection: Sentinel1
    S1_SAR_OCN:
      product_type: OCN
      collection: Sentinel1
    S3_LAN:
      product_type: LAN
      collection: Sentinel3
    S3_SRA:
      product_type: SRA
      collection: Sentinel3
    S3_SRA_BS:
      product_type: SRA_BS
      collection: Sentinel3
    S3_SRA_A_BS:
      product_type: SRA_A
      collection: Sentinel3
    S3_EFR:
      product_type: EFR
      collection: Sentinel3
    S3_ERR:
      product_type: ERR
      collection: Sentinel3
    S3_WAT:
      product_type: WAT
      collection: Sentinel3
    S3_SLSTR_L2LST:
      product_type: LST
      collection: Sentinel3
    S3_OLCI_L2LRR:
      product_type: LRR
      collection: Sentinel3
    S3_OLCI_L2LFR:
      product_type: LFR
      collection: Sentinel3
    S3_SLSTR_L1RBT:
      product_type: RBT
      collection: Sentinel3

---
!provider
  name: mundi
  priority: 0
  search: !plugin
    type: QueryStringSearch
    api_endpoint: 'https://mundiwebservices.com/acdc/catalog/proxy/search/{collection}/opensearch'
    result_type: 'xml'
    results_entry: '//ns:entry'
    literal_search_params:
      format: atom
      relation: intersects
    free_text_search_operations:
      q:
        union: ' AND '
        wrapper: '({})'
        operations:
          AND:
            - 'sensingStartDate:[{startTimeFromAscendingNode}Z TO *]'
            - 'sensingStopDate:[* TO {completionTimeFromAscendingNode}Z]'
    pagination:
      next_page_url_tpl: '{url}?{search}&maxRecords={items_per_page}&startIndex={page}'
      total_items_nb_key_path: '//os:totalResults/text()'
    metadata_mapping:
      # OpenSearch Parameters for Collection Search (Table 3)
      productType:
        - 'productType'
        - 'eo:productType/text()'
      doi: 'eo:doi/text()'
      platform: 'eo:platform/text()'
      platformSerialIdentifier: 'eo:platformSerialIdentifier/text()'
      instrument: 'eo:instrument/text()'
      sensorType: 'eo:sensorType/text()'
      compositeType: 'eo:compositeType/text()'
      processingLevel: 'eo:processingLevel/text()'
      orbitType: 'eo:orbitType/text()'
      spectralRange: 'eo:spectralRange/text()'
      wavelengths: 'eo:wavelengths/text()'
      hasSecurityConstraints: 'eo:hasSecurityConstraints/text()'
      dissemination: 'eo:dissemination/text()'

      # INSPIRE obligated OpenSearch Parameters for Collection Search (Table 4)
      title: 'eo:title/text()'
      topicCategory: 'ns:category/text()'
      keyword: 'eo:keyword/text()'
      abstract: 'ns:summary/text()'
      resolution: 'eo:resolution/text()'
      organisationName: 'dc:creator/text()'
      organisationRole: 'eo:organisationRole/text()'
      publicationDate: 'ns:published/text()'
      lineage: 'eo:lineage/text()'
      useLimitation: 'eo:useLimitation/text()'
      accessConstraint: 'eo:accessConstraint/text()'
      otherConstraint: 'dc:rights/text()'
      classification: 'DIAS:productConfidentialityLevel/text()'
      language: 'eo:language/text()'
      specification: 'eo:specification/text()'

      # OpenSearch Parameters for Product Search (Table 5)
      parentIdentifier: 'eo:parentIdentifier/text()'
      productionStatus: 'DIAS:onlineStatus/text()'
      acquisitionType: 'eo:acquisitionType/text()'
      orbitNumber: 'eo:orbitNumber/text()'
      orbitDirection: 'eo:orbitDirection/text()'
      track: 'eo:track/text()'
      frame: 'eo:frame/text()'
      swathIdentifier: 'eo:swathIdentifier/text()'
      cloudCover: 'eo:cloudCover/text()'
      snowCover: 'eo:snowCover/text()'
      lowestLocation: 'eo:lowestLocation/text()'
      highestLocation: 'eo:highestLocation/text()'
      productVersion: 'DIAS:processingBaseline/text()'
      productQualityStatus: 'eo:productQualityStatus/text()'
      productQualityDegradationTag: 'eo:productQualityDegradationTag/text()'
      processorName: 'eo:processorName/text()'
      processingCenter: 'eo:processingCenter/text()'
      creationDate: 'DIAS:onlineDate/text()'
      modificationDate: 'ns:updated/text()'
      processingDate: 'eo:processingDate/text()'
      sensorMode: 'eo:sensorMode/text()'
      archivingCenter: 'eo:archivingCenter/text()'
      processingMode: 'eo:processingMode/text()'

      # OpenSearch Parameters for Acquistion Parameters Search (Table 6)
      availabilityTime: 'DIAS:onlineDate/text()'
      acquisitionStation: 'eo:acquisitionStation/text()'
      acquisitionSubType: 'eo:acquisitionSubType/text()'
      startTimeFromAscendingNode: 'DIAS:sensingStartDate/text()'
      completionTimeFromAscendingNode: 'DIAS:sensingStopDate/text()'
      illuminationAzimuthAngle: 'eo:illuminationAzimuthAngle/text()'
      illuminationZenithAngle: 'eo:illuminationZenithAngle/text()'
      illuminationElevationAngle: 'eo:illuminationElevationAngle/text()'
      polarizationMode: 'eo:polarizationMode/text()'
      polarisationChannels: 'eo:polarisationChannels/text()'
      antennaLookDirection: 'eo:antennaLookDirection/text()'
      minimumIncidenceAngle: 'eo:minimumIncidenceAngle/text()'
      maximumIncidenceAngle: 'eo:maximumIncidenceAngle/text()'
      dopplerFrequency: 'eo:dopplerFrequency/text()'
      incidenceAngleVariation: 'eo:incidenceAngleVariation/text()'

      # Custom parameters (not defined in the base document referenced above)
      id: 'ns:id/text()'
      # The geographic extent of the product
      geometry:
        - 'bbox={geometry[lonmin]},{geometry[latmin]},{geometry[lonmax]},{geometry[latmax]}'
        - 'georss:box/text()'
      # The url of the quicklook
      quicklook: 'media:group/media:content[media:category="QUICKLOOK"]/@url'
      # The url to download the product "as is" (literal or as a template to be completed either after the search result
      # is obtained from the provider or during the eodag download phase)
      downloadLink: 'ns:link[@rel="enclosure"]/@href'

      # Additional metadata provided by the providers but that don't appear in the reference spec
      metadataFormat: 'DIAS:metadataFormat/text()'
      imageFileFormat: 'DIAS:imageFileFormat/text()'
      orderID: 'DIAS:orderID/text()'
      sceneIndex: 'DIAS:sceneIndex/text()'
      thumbnail: 'media:group/media:content[media:category="THUMBNAIL"]/@url'
      identifier: 'dc:identifier/text()'
      date: 'dc:date/text()'
      generalQuality: 'DIAS:generalQuality/text()'
      sensorQuality: 'DIAS:sensorQuality/text()'
      radiometricQuality: 'DIAS:radiometricQuality/text()'
      geometricQuality: 'DIAS:geometricQuality/text()'
      formatCorrectness: 'DIAS:formatCorrectness/text()'
      equivalentNumberOfScene: 'DIAS:equivalentNumberOfScene/text()'
      audience: 'dct:audience/text()'
      archiveInstanceReference: 'DIAS:archiveInstanceReference/text()'
      productDatapackSize: 'DIAS:productDatapackSize/text()'
      format: 'dc:format/text()'
      startOrbitNumber: 'DIAS:startOrbitNumber/text()'
      datatakeId: 'DIAS:datatakeId/text()'
      tileIdentifier: 'DIAS:tileIdentifier/text()'
      manualQualityCheckStatus: 'DIAS:manualQualityCheckStatus/text()'
      manualQualityCheckStatusComment: 'DIAS:manualQualityCheckStatusComment/text()'
      referenceProductOnly: 'DIAS:referenceProductOnly/text()'
      watcherRecordValidity: 'DIAS:watcherRecordValidity/text()'
      productDeliveryFormat: 'DIAS:productDeliveryFormat/text()'
      checksum: 'DIAS:checksum/text()'
  download: !plugin
    type: AwsDownload
  auth: !plugin
    type: OAuth
  products:
    S1_SAR_RAW:
      product_type: RAW
      collection: Sentinel1
    S1_SAR_GRD:
      product_type: GRD
      collection: Sentinel1
    S1_SAR_SLC:
      product_type: SLC
      collection: Sentinel1
    S1_SAR_OCN:
      product_type: OCN
      collection: Sentinel1
    S2_MSI_L1C:
      product_type: IMAGE
      collection: Sentinel2
    S2_MSI_L2A:
      product_type: S2MSI2Ap
      collection: Sentinel2

---
!provider
  name: wekeo
  priority: 0
  search: !plugin
    type: CSWSearch
    api_endpoint: 'https://www.wekeo.eu/elastic-csw/service'
    metadata_mapping:
      id: 'dc:identifier/text()'
      productType: 'dct:alternative/text()'
      title: 'dc:title/text()'
      abstract: 'dct:abstract/text()'
      quicklook: 'https://www.wekeo.eu/sites/default/files/quicklooks/{productType}.jpg'
      keyword: 'dc:subject[text()]'
    search_definition:
      product_type_tags:
        - name: 'dc:identifier' # any xml tag of the catalogue that can be queryable
          matching: exact # One of exact (eq. to L1C for ex), prefix (eq. *L1C), postfix (eq. L1C*) or fuzzy (eq. *L1C*)
  download: !plugin
    type: HTTPDownload
  auth: !plugin
    type: GenericAuth
  products:
    S1_SAR_GRD:
      product_type: "EO:ESA:DAT:SENTINEL-1:L1_GRD"
    S1_SAR_SLC:
      product_type: "EO:ESA:DAT:SENTINEL-1:L1_SLC"
    S2_MSI_L1C:
      product_type: "EO:ESA:DAT:SENTINEL-2:MSI1C"
    S3_LAN:
      product_type: "EO:ESA:DAT:SENTINEL-3:SR_2_LAN___"
    S3_SRA:
      product_type: "EO:EUM:DAT:SENTINEL-3:SR_1_SRA___"
    S3_SRA_BS:
      product_type: "EO:EUM:DAT:SENTINEL-3:SR_1_SRA_BS___"
    S3_EFR:
      product_type: "EO:EUM:DAT:SENTINEL-3:OL_1_EFR___"
    S3_ERR:
      product_type: "EO:EUM:DAT:SENTINEL-3:OL_1_ERR___"
    S3_WAT:
      product_type: "EO:EUM:DAT:SENTINEL-3:SR_2_WAT___"
    S3_SLSTR_L2LST:
      product_type: "EO:ESA:DAT:SENTINEL-3:SL_2_LST___"
    S3_OLCI_L2LRR:
      product_type: "EO:ESA:DAT:SENTINEL-3:OL_2_LRR___"
    S3_OLCI_L2LFR:
      product_type: "EO:ESA:DAT:SENTINEL-3:OL_2_LFR___"
    S3_SLSTR_L1RBT:
      product_type: "EO:EUM:DAT:SENTINEL-3:SL_1_RBT___"

---
!provider
  name: onda
  priority: 0
  search: !plugin
    type: ODataV4Search
    api_endpoint: 'https://catalogue.onda-dias.eu/dias-catalogue/Products'
    pagination:
      count_endpoint: 'https://catalogue.onda-dias.eu/dias-catalogue/Products/$count'
      next_page_url_tpl: '{url}?{search}&$top={items_per_page}&$skip={skip}'
    results_entry: 'value'
    literal_search_params:
      $format: json
    free_text_search_operations:
      $search:
        union: ' OR '
        wrapper: '"{}"'
        operations:
          AND:
            - 'footprint:"Intersects({geometry#to_wkt})"'
            - 'productType:{productType}'
            - 'cloudCoverPercentage:[0 TO {cloudCover}]'
            - 'beginPosition:[{startTimeFromAscendingNode#to_iso_utc_datetime} TO *]'
            - 'endPosition:[* TO {completionTimeFromAscendingNode#to_iso_utc_datetime}]'
    metadata_mapping:
      # OpenSearch Parameters for Collection Search (Table 3)
      productType: '$.productType'
      platform: '$.platformName'
      platformSerialIdentifier: '$.platformSerialIdentifier'
      instrument: '$.instrumentName'
      processingLevel: '$.processingLevel'

      # INSPIRE obligated OpenSearch Parameters for Collection Search (Table 4)
      title: '$.filename'

      # OpenSearch Parameters for Product Search (Table 5)
      orbitNumber: '$.orbitNumber'
      orbitDirection: '$.orbitDirection'
      cloudCover: '$.cloudCoverPercentage'
      productVersion: '$.processingBaseline'
      productQualityStatus: '$.generalQualityFlag'
      creationDate: '$.creationDate'
      processingDate: '$.processingDate'
      sensorMode: '$.sensorOperationalMode'

      # OpenSearch Parameters for Acquistion Parameters Search (Table 6)
      startTimeFromAscendingNode: '$.beginPosition'
      completionTimeFromAscendingNode: '$.endPosition'

      # Custom parameters (not defined in the base document referenced above)
      id: '$.id'
      # The geographic extent of the product
      geometry: '$.footprint'
      # The url of the quicklook
      quicklook: '$.quicklook'
      # The url to download the product "as is" (literal or as a template to be completed either after the search result
      # is obtained from the provider or during the eodag download phase)
      downloadLink: '%(base_uri)s({id})/$value'

      # Additional metadata provided by the providers but that don't appear in the reference spec
      radiometricQualityFlag: '$.radiometricQualityFlag'
      sensorQualityFlag: '$.sensorQualityFlag'
      geometricQualityFlag: '$.geometricQualityFlag'
      formatCorrectnessFlag: '$.formatCorrectnessFlag'
      format: '$.format'
      dataTakeIdentifier: '$.dataTakeIdentifier'
      size: '$.size'
      dataTakeSensingStart: '$.dataTakeSensingStart'
      relativeOrbitNumber: '$.relativeOrbitNumber'
      platformNssdcid: '$.platformNssdcid'
      platformShortName: '$.platformShortName'
      instrumentShortName: '$.instrumentShortName'
      degradedMSIDataPercentage: '$.degradedMSIDataPercentage'
      degradedAncillaryDataPercentage: '$.degradedAncillaryDataPercentage'
  products:
    S1_SAR_OCN:
      product_type: '*OCN*'
    S1_SAR_GRD:
      product_type: '*GRD*'
    S1_SAR_SLC:
      product_type: '*SLC*'
    S1_SAR_RAW:
      product_type: '*RAW*'
    S2_MSI_L1C:
      product_type: S2MSI1C
    S2_MSI_L2A:
      product_type: S2MSI2A
    S3_EFR:
      product_type: OL_1_EFR___
    S3_ERR:
      product_type: OL_1_ERR___
    S3_OLCI_L2LFR:
      product_type: OL_2_LFR___
    S3_OLCI_L2LRR:
      product_type: OL_2_LRR___
    S3_SLSTR_L1RBT:
      product_type: SL_1_RBT___
    S3_SLSTR_L2LST:
      product_type: SL_2_LST___
    S3_LAN:
      product_type: SR_2_LAN___
    S3_SRA:
      product_type: SR_1_SRA_A_
    S3_SRA_BS:
      product_type: SR_1_SRA_BS
    S3_SRA_A_BS:
      product_type: SR_1_SRA___
    S3_WAT:
      product_type: SR_2_WAT___
    L8_L1GT:
      product_type: L1GT
    L8_L1T:
      product_type: L1T
  download: !plugin
    type: HTTPDownload
    base_uri: 'https://catalogue.onda-dias.eu/dias-catalogue/Products'
    extract: true
  auth: !plugin
    type: GenericAuth
